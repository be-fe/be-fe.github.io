<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title> 书写组件 DEMO 的一些方案 | 百度EUX </title>
    <link rel="stylesheet" href="/style.css">
    <script>
      (function() {
        var hm = document.createElement("script");
        hm.src = "//hm.baidu.com/hm.js?d232748d06c1fe09a6db3db0077669b7";
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);
      })();

      var _vds = _vds || [];
      window._vds = _vds;
      (function () {
        _vds.push(['setAccountId', '66707fb8b27442d5b3ccca57a56800fa']);
        _vds.push(['trackBot', false]);

        (function () {
          var vds = document.createElement('script');
          vds.type = 'text/javascript';
          vds.async = true;
          vds.src = '//dn-growing.qbox.me/vds.js';
          var s = document.getElementsByTagName('script')[0];
          s.parentNode.insertBefore(vds, s);
        })();
      })();
    </script>
</head>
<body>
<div id="root">
    <div class="main" data-reactroot="" data-reactid="1" data-react-checksum="-1395512637"><!-- react-empty: 2 --><header class="eux-header clearfix" data-reactid="3"><div class="eux-header-top" data-reactid="4"><a href="javascript:void(0);" class="eux-portable-menu" data-reactid="5"><span data-reactid="6"></span><span data-reactid="7"></span><span data-reactid="8"></span></a><!-- react-empty: 9 --><nav class="menu-primary-container" data-reactid="10"><ul id="menu-primary" class="menu" data-reactid="11"><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-25" data-reactid="12"><a href="/" data-reactid="13">HOME</a></li><li class="menu-item menu-item-type-custom menu-item-object-custom current-menu-ancestor current-menu-parent menu-item-has-children menu-item-45" data-reactid="14"><a href="/" data-reactid="15">BLOG</a><ul class="sub-menu" data-reactid="16"><li class="menu-item menu-item-type-taxonomy menu-item-object-category current-menu-item menu-item-63" data-reactid="17"><a href="/ue" data-reactid="18">交互</a></li><li class="menu-item menu-item-type-taxonomy menu-item-object-category current-menu-item menu-item-63" data-reactid="19"><a href="/ui" data-reactid="20">视觉</a></li><li class="menu-item menu-item-type-taxonomy menu-item-object-category current-menu-item menu-item-63" data-reactid="21"><a href="/fe" data-reactid="22">前端</a></li><li class="menu-item menu-item-type-taxonomy menu-item-object-category current-menu-item menu-item-63" data-reactid="23"><a href="/team" data-reactid="24">团队</a></li></ul></li><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-46" data-reactid="25"><a href="/tools" data-reactid="26">TOOLS</a></li><li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-112" data-reactid="27"><a href="/works" data-reactid="28">WORKS</a></li><li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-138" data-reactid="29"><a href="/jobs" data-reactid="30">JOBS</a></li><li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-50" data-reactid="31"><a href="/about-us" data-reactid="32">ABOUT US</a></li></ul></nav></div></header><div class="eux-singular clearfix" data-reactid="33"><div class="container-singular clearfix" data-reactid="34"><nav class="menu-categories-container" data-reactid="35"><ul id="menu-categories" class="menu" data-reactid="36"><li class="menu-item menu-item-type-custom menu-item-object-custom current_page_item menu-item-55" data-reactid="37"><span data-reactid="38"><a href="/" data-reactid="39">全部</a></span></li><li class="menu-item menu-item-type-custom menu-item-object-custom current_page_item menu-item-55" data-reactid="40"><span data-reactid="41"><a href="/ue" data-reactid="42">交互</a></span></li><li class="menu-item menu-item-type-custom menu-item-object-custom current_page_item menu-item-55" data-reactid="43"><span data-reactid="44"><a href="/ui" data-reactid="45">视觉</a></span></li><li class="current-menu-item menu-item menu-item-type-custom menu-item-object-custom current_page_item menu-item-55" data-reactid="46"><span data-reactid="47"><a href="/fe" data-reactid="48">前端</a></span></li><li class="menu-item menu-item-type-custom menu-item-object-custom current_page_item menu-item-55" data-reactid="49"><span data-reactid="50"><a href="/team" data-reactid="51">团队</a></span></li></ul></nav><div class="inner clearfix" data-reactid="52"><div class="article-meta" data-reactid="53"><h1 class="title" data-reactid="54">书写组件 DEMO 的一些方案</h1><div class="eux-page-detail" data-reactid="55"><span data-reactid="56"><em data-reactid="57">by.</em><!-- react-text: 58 -->余聪<!-- /react-text --></span><span data-reactid="59">2018-6-30</span></div></div><article data-reactid="60"><p data-reactid="61">目前前端开发都推崇一致组件化的开发思想，即看到业务页面之后，先不着急写页面；而是先观察，把一些具有共性的UI控件包装成组件（如 React/Vue/Web Component）。这样做的好处不言而喻，提供组件复用率，团队开发效率提升明显。</p><p data-reactid="62">既然组件化的思想这么重要，那么对于某个组件单元，它本身是不依赖外部环境（如外部静态资源）的；同时它内部也需要有它自己的单元测试、文档，甚至包含 DEMO 代码。</p><p data-reactid="63">对于单元测试、文档的意义不属于该文讨论范畴，下面展开说说组件 DEMO 的意义</p><h2 id="组件-demo-的意义" data-reactid="64"><a href="#%E7%BB%84%E4%BB%B6-demo-%E7%9A%84%E6%84%8F%E4%B9%89" aria-hidden="true" data-reactid="65"><span class="icon icon-link" data-reactid="66"></span></a><!-- react-text: 67 -->组件 DEMO 的意义<!-- /react-text --></h2><h3 id="沟通、共享" data-reactid="68"><a href="#%E6%B2%9F%E9%80%9A%E3%80%81%E5%85%B1%E4%BA%AB" aria-hidden="true" data-reactid="69"><span class="icon icon-link" data-reactid="70"></span></a><!-- react-text: 71 -->沟通、共享<!-- /react-text --></h3><p data-reactid="72">项目开发人数一般为多人，多人开发的情境下，多了一份沟通的开销。</p><p data-reactid="73">在没有 DEMO 的情景下，项目成员都是交叉沟通的（如该组件具体怎么用），而且这种沟通大都是低效的（无沉淀）； 而 组件 DEMO 的出现将内容聚合起来，项目成员都是面向 DEMO，去除了项目成员冗余沟通，表现方式也更为直观。</p><p data-reactid="74">如果 DEMO 可以可视化集成文档，那么体验则更美妙。</p><h3 id="集成测试" data-reactid="75"><a href="#%E9%9B%86%E6%88%90%E6%B5%8B%E8%AF%95" aria-hidden="true" data-reactid="76"><span class="icon icon-link" data-reactid="77"></span></a><!-- react-text: 78 -->集成测试<!-- /react-text --></h3><p data-reactid="79">组件 DEMO 另一个更为重要的意义则是方便 “集成测试”。拥有 DEMO 之后，我们可以直接使用 DEMO 服务去进行集成测试，而不需要额外搭建环境。</p><h2 id="实现组件-demo" data-reactid="80"><a href="#%E5%AE%9E%E7%8E%B0%E7%BB%84%E4%BB%B6-demo" aria-hidden="true" data-reactid="81"><span class="icon icon-link" data-reactid="82"></span></a><!-- react-text: 83 -->实现组件 DEMO<!-- /react-text --></h2><p data-reactid="84">不同组件有不同的 DEMO，一个组件还可能拥有多个 DEMO case，所以 DEMO 服务应该是有多路由的，</p><p data-reactid="85">基于添加路由的方式不同，我将实现组件 DEMO 的方式划为两种方式：静态添加路由、动态添加路由。</p><h3 id="静态（不推荐）" data-reactid="86"><a href="#%E9%9D%99%E6%80%81%EF%BC%88%E4%B8%8D%E6%8E%A8%E8%8D%90%EF%BC%89" aria-hidden="true" data-reactid="87"><span class="icon icon-link" data-reactid="88"></span></a><!-- react-text: 89 -->静态（不推荐）<!-- /react-text --></h3><p data-reactid="90">通过模板去自动生成各个组件的 DEMO 路由代码；触发流程应该为：新建 demo 后，执行命令去写入静态路由</p><p data-reactid="91">这种方法相对简单、不优雅，本文不展开说明</p><h3 id="运行时，动态路由匹配" data-reactid="92"><a href="#%E8%BF%90%E8%A1%8C%E6%97%B6%EF%BC%8C%E5%8A%A8%E6%80%81%E8%B7%AF%E7%94%B1%E5%8C%B9%E9%85%8D" aria-hidden="true" data-reactid="93"><span class="icon icon-link" data-reactid="94"></span></a><!-- react-text: 95 -->运行时，动态路由匹配<!-- /react-text --></h3><p data-reactid="96"><!-- react-text: 97 -->其实市面上已经有一些现场的 DEMO 服务解决方案，如 <!-- /react-text --><a href="https://github.com/storybooks/storybook" data-reactid="98">storybook</a><!-- react-text: 99 --> 和 <!-- /react-text --><a href="https://github.com/styleguidist/react-styleguidist" data-reactid="100">react-styleguidist</a><!-- react-text: 101 --> 它们的共同点是他们都是独立的 webpack 环境，生态都很全面；<!-- /react-text --></p><p data-reactid="102">但是对于有些情况下，我们组件代码和 DEMO 是依赖我们项目环境的（如 webpack 配置，或者其他老项目依赖外部的静态资源），所以以上的方案可能不太适合，这时候就需要我们自己动手写一个 DEMO 架子了。</p><h4 id="demo-架子" data-reactid="103"><a href="#demo-%E6%9E%B6%E5%AD%90" aria-hidden="true" data-reactid="104"><span class="icon icon-link" data-reactid="105"></span></a><!-- react-text: 106 -->DEMO 架子<!-- /react-text --></h4><p data-reactid="107"><!-- react-text: 108 -->其实动态路由添加的实现是基于 Webpack 中的 <!-- /react-text --><code data-reactid="109">require.context</code><!-- react-text: 110 --> 方法的<!-- /react-text --></p><p data-reactid="111"><code data-reactid="112">require.context(path, useSubdirectories, regExp)</code><!-- react-text: 113 --> 方法有三个参数<!-- /react-text --></p><ul data-reactid="114"><li data-reactid="115"><code data-reactid="116">path</code><!-- react-text: 117 -->: 要搜索的文件夹目录<!-- /react-text --></li><li data-reactid="118"><code data-reactid="119">useSubdirectories</code><!-- react-text: 120 -->: 是否还应该搜索它的子目录<!-- /react-text --></li><li data-reactid="121"><code data-reactid="122">regExp</code><!-- react-text: 123 --> 一个匹配文件的正则表达式<!-- /react-text --></li></ul><p data-reactid="124"><code data-reactid="125">require.context</code><!-- react-text: 126 --> 返回一个（require）函数，这个函数可以接收一个参数：<!-- /react-text --><code data-reactid="127">path</code><!-- react-text: 128 --> （这个 path 是基于要搜索的文件夹目录的）<!-- /react-text --></p><p data-reactid="129"><!-- react-text: 130 -->实际上 <!-- /react-text --><code data-reactid="131">require.context</code><!-- react-text: 132 --> 是一个 Webpack 编译阶段用到的语法，而不是前端代码，所以如果执行 <!-- /react-text --><code data-reactid="133">console.log(require.context)</code><!-- react-text: 134 --> 打印的是 <!-- /react-text --><code data-reactid="135">undefined</code></p><p data-reactid="136">如果我们组件的文件结构为:</p><pre data-reactid="137"><code data-query="{}" data-lang="data-lang" data-reactid="138">components/
    Button/
        ...
        demo/  # 对应不同 case 的 demo 代码
            caseA.js
            caseB.js
</code></pre><p data-reactid="139">使用该方法，我们可以使用如下代码来动态选择加载 DEMO 代码</p><pre data-reactid="140"><code class="hljs language-javascript" data-query="{}" data-lang="javascript" data-reactid="141"><span class="hljs-keyword" data-reactid="142">const</span><!-- react-text: 143 --> req = <!-- /react-text --><span class="hljs-built_in" data-reactid="144">require</span><!-- react-text: 145 -->.context(<!-- /react-text --><span class="hljs-string" data-reactid="146">&#x27;components&#x27;</span><!-- react-text: 147 -->, <!-- /react-text --><span class="hljs-literal" data-reactid="148">true</span><!-- react-text: 149 -->, /\/demo\/.+?\.js$/)
<!-- /react-text --><span class="hljs-comment" data-reactid="150">// 加载 DEMO</span><!-- react-text: 151 -->
req.keys().map(<!-- /react-text --><span class="hljs-function" data-reactid="152"><span class="hljs-params" data-reactid="153">filename</span><!-- react-text: 154 --> =&gt;<!-- /react-text --></span><!-- react-text: 155 --> req(filename))<!-- /react-text --></code></pre><p data-reactid="156">基于以上代码，我们可以动态的生成路由，从而渲染组件 DEMO</p><p data-reactid="157"><!-- react-text: 158 -->同时安利一个 React 高阶组件 <!-- /react-text --><a href="https://github.com/m-cuttlefish/react-mhoc" data-reactid="159">react-hoc/editable</a><!-- react-text: 160 -->，使用这个高阶组件可以<!-- /react-text --><strong data-reactid="161">可视化操作更新组件数据</strong><!-- react-text: 162 -->，使我们更方便的修改组件内部的数据，从而更了解组件的使用。<!-- /react-text --></p><p data-reactid="163"><a href="https://m-cuttlefish.github.io/react-mhoc/page/" data-reactid="164">react-hoc/editable DEMO 地址</a></p><p data-reactid="165">你觉得你只有 DEMO 视图还不够，还需要 DEMO 源码展示？</p><h5 id="加上-demo-源码展示" data-reactid="166"><a href="#%E5%8A%A0%E4%B8%8A-demo-%E6%BA%90%E7%A0%81%E5%B1%95%E7%A4%BA" aria-hidden="true" data-reactid="167"><span class="icon icon-link" data-reactid="168"></span></a><!-- react-text: 169 -->加上 DEMO 源码展示<!-- /react-text --></h5><p data-reactid="170"><!-- react-text: 171 -->使用 webpack 的 <!-- /react-text --><code data-reactid="172">raw-loader</code><!-- react-text: 173 -->，即可加载 DEMO 为源码文本<!-- /react-text --></p><pre data-reactid="174"><code class="hljs language-javascript" data-query="{}" data-lang="javascript" data-reactid="175"><span class="hljs-keyword" data-reactid="176">const</span><!-- react-text: 177 --> rawReq = <!-- /react-text --><span class="hljs-built_in" data-reactid="178">require</span><!-- react-text: 179 -->.context(<!-- /react-text --><span class="hljs-string" data-reactid="180">&#x27;!raw-loader!dulife-ui&#x27;</span><!-- react-text: 181 -->, <!-- /react-text --><span class="hljs-literal" data-reactid="182">true</span><!-- react-text: 183 -->, /\/demo\/.+?\.js$/)<!-- /react-text --></code></pre><p data-reactid="184"><!-- react-text: 185 -->最终效果如下： <!-- /react-text --><img src="https://eux-public.bj.bcebos.com/2018/07/09/5b3741de4ed1e.png" alt="alt" width="1614" height="950" data-reactid="186"/></p><h2 id="结尾" data-reactid="187"><a href="#%E7%BB%93%E5%B0%BE" aria-hidden="true" data-reactid="188"><span class="icon icon-link" data-reactid="189"></span></a><!-- react-text: 190 -->结尾<!-- /react-text --></h2><p data-reactid="191"><!-- react-text: 192 -->本人还是推荐动态添加路由方式中的 <!-- /react-text --><a href="https://github.com/storybooks/storybook" data-reactid="193">storybook</a><!-- react-text: 194 --> 和 <!-- /react-text --><a href="https://github.com/styleguidist/react-styleguidist" data-reactid="195">react-styleguidist</a><!-- react-text: 196 --> 生态！<!-- /react-text --></p></article><div data-reactid="197"></div><nav class="single-bar clearfix" data-reactid="198"><span class="prev" data-reactid="199"><a rel="prev" href="/blog/fe/npm aduit二三事" data-reactid="200"><em class="eux-icon eux-icon-page-prev" data-reactid="201"></em><!-- react-text: 202 -->npm audit 二三事<!-- /react-text --></a></span><span class="next" data-reactid="203"><a rel="next" href="/blog/fe/控制图标颜色" data-reactid="204"><em class="eux-icon eux-icon-page-next" data-reactid="205"></em><!-- react-text: 206 -->CSS 控制图标颜色<!-- /react-text --></a></span></nav></div></div></div><footer class="footer" data-reactid="207"><div class="eux-footer-area-wrapper container-singular" role="complementary" data-reactid="208"><div class="inner clearfix" data-reactid="209"><aside id="simple-links-2" class="widget sl-links-main" data-reactid="210"><h2 class="widgettitle" data-reactid="211">友情链接</h2><ul class="simple-links-list simple-links-2-list" id="simple-links-2-list" data-reactid="212"><li class="simple-links-item simple-links-widget-item" id="link-379" data-reactid="213"><a target="_blank" href="http://sux.baidu.com/" title="百度 FEX 团队" data-reactid="214">百度 FEX</a></li><li class="simple-links-item simple-links-widget-item" id="link-379" data-reactid="215"><a target="_blank" href="http://efe.baidu.com/" title="百度 EFE 团队" data-reactid="216">百度 EFE</a></li><li class="simple-links-item simple-links-widget-item" id="link-379" data-reactid="217"><a target="_blank" href="http://sux.baidu.com/" title="百度 SUX 团队" data-reactid="218">百度 SUX</a></li><li class="simple-links-item simple-links-widget-item" id="link-379" data-reactid="219"><a target="_blank" href="https://aotu.io/" title="京东凹凸实验室，面向多终端技术体系，致力于构建沉淀与分享包括但不限于交互、页面制作技巧、前端开发、原生APP开发等方面的专业知识及案例。" data-reactid="220">凹凸实验室</a></li><li class="simple-links-item simple-links-widget-item" id="link-379" data-reactid="221"><a target="_blank" href="https://fed.renren.com/" title="人人网FED" data-reactid="222">人人网FED</a></li></ul></aside></div></div><div class="eux-icp" data-reactid="223"><!-- react-text: 224 -->百度EUX 版权所有 ©百度EUX    All rights reserved. 骄傲地采用 <!-- /react-text --><a target="_blank" href="https://github.com/picidaejs/picidaejs" data-reactid="225">Picidae</a><!-- react-text: 226 -->。<!-- /react-text --></div></footer></div>
</div>
<script src="/PICIDAE_COMMON.js"></script>
<script src="/PICIDAE_ENTRY.js"></script>
</body>
</html>