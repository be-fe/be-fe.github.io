<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title> 前后端数据传输不得不面对的转码问题 | 百度EUX </title>
    <link rel="stylesheet" href="/style.css">
    <script>
      (function() {
        var hm = document.createElement("script");
        hm.src = "//hm.baidu.com/hm.js?d232748d06c1fe09a6db3db0077669b7";
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);
      })();

      var _vds = _vds || [];
      window._vds = _vds;
      (function () {
        _vds.push(['setAccountId', '66707fb8b27442d5b3ccca57a56800fa']);
        _vds.push(['trackBot', false]);

        (function () {
          var vds = document.createElement('script');
          vds.type = 'text/javascript';
          vds.async = true;
          vds.src = '//dn-growing.qbox.me/vds.js';
          var s = document.getElementsByTagName('script')[0];
          s.parentNode.insertBefore(vds, s);
        })();
      })();
    </script>
</head>
<body>
<div id="root">
    <div class="main" data-reactroot="" data-reactid="1" data-react-checksum="-1761506324"><!-- react-empty: 2 --><header class="eux-header clearfix" data-reactid="3"><div class="eux-header-top" data-reactid="4"><a href="javascript:void(0);" class="eux-portable-menu" data-reactid="5"><span data-reactid="6"></span><span data-reactid="7"></span><span data-reactid="8"></span></a><!-- react-empty: 9 --><nav class="menu-primary-container" data-reactid="10"><ul id="menu-primary" class="menu" data-reactid="11"><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-25" data-reactid="12"><a href="/" data-reactid="13">HOME</a></li><li class="menu-item menu-item-type-custom menu-item-object-custom current-menu-ancestor current-menu-parent menu-item-has-children menu-item-45" data-reactid="14"><a href="/" data-reactid="15">BLOG</a><ul class="sub-menu" data-reactid="16"><li class="menu-item menu-item-type-taxonomy menu-item-object-category current-menu-item menu-item-63" data-reactid="17"><a href="/ue" data-reactid="18">交互</a></li><li class="menu-item menu-item-type-taxonomy menu-item-object-category current-menu-item menu-item-63" data-reactid="19"><a href="/ui" data-reactid="20">视觉</a></li><li class="menu-item menu-item-type-taxonomy menu-item-object-category current-menu-item menu-item-63" data-reactid="21"><a href="/fe" data-reactid="22">前端</a></li><li class="menu-item menu-item-type-taxonomy menu-item-object-category current-menu-item menu-item-63" data-reactid="23"><a href="/team" data-reactid="24">团队</a></li></ul></li><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-46" data-reactid="25"><a href="/tools" data-reactid="26">TOOLS</a></li><li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-112" data-reactid="27"><a href="/works" data-reactid="28">WORKS</a></li><li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-138" data-reactid="29"><a href="/jobs" data-reactid="30">JOBS</a></li><li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-50" data-reactid="31"><a href="/about-us" data-reactid="32">ABOUT US</a></li></ul></nav></div></header><div class="eux-singular clearfix" data-reactid="33"><div class="container-singular clearfix" data-reactid="34"><nav class="menu-categories-container" data-reactid="35"><ul id="menu-categories" class="menu" data-reactid="36"><li class="menu-item menu-item-type-custom menu-item-object-custom current_page_item menu-item-55" data-reactid="37"><span data-reactid="38"><a href="/" data-reactid="39">全部</a></span></li><li class="menu-item menu-item-type-custom menu-item-object-custom current_page_item menu-item-55" data-reactid="40"><span data-reactid="41"><a href="/ue" data-reactid="42">交互</a></span></li><li class="menu-item menu-item-type-custom menu-item-object-custom current_page_item menu-item-55" data-reactid="43"><span data-reactid="44"><a href="/ui" data-reactid="45">视觉</a></span></li><li class="current-menu-item menu-item menu-item-type-custom menu-item-object-custom current_page_item menu-item-55" data-reactid="46"><span data-reactid="47"><a href="/fe" data-reactid="48">前端</a></span></li><li class="menu-item menu-item-type-custom menu-item-object-custom current_page_item menu-item-55" data-reactid="49"><span data-reactid="50"><a href="/team" data-reactid="51">团队</a></span></li></ul></nav><div class="inner clearfix" data-reactid="52"><div class="article-meta" data-reactid="53"><h1 class="title" data-reactid="54">前后端数据传输不得不面对的转码问题</h1><div class="eux-page-detail" data-reactid="55"><span data-reactid="56"><em data-reactid="57">by.</em><!-- react-text: 58 -->v_guoyunan<!-- /react-text --></span><span data-reactid="59">2017-12-11</span></div></div><article data-reactid="60"><h3 id="数据传递转码" data-reactid="61"><a href="#%E6%95%B0%E6%8D%AE%E4%BC%A0%E9%80%92%E8%BD%AC%E7%A0%81" aria-hidden="true" data-reactid="62"><span class="icon icon-link" data-reactid="63"></span></a><!-- react-text: 64 -->数据传递转码<!-- /react-text --></h3><p data-reactid="65"><!-- react-text: 66 -->数据在传输的过程中，浏览器会对数据进行编码，假如我现在有一条数据 <!-- /react-text --><code data-reactid="67">{&quot;name&quot;: &quot;测试&quot;}</code><!-- react-text: 68 -->，如果我们通过 <!-- /react-text --><code data-reactid="69">get</code><!-- react-text: 70 --> 方法传递数据，这条数据会被拼接到 <!-- /react-text --><code data-reactid="71">url</code><!-- react-text: 72 --> 请求的后面，如：<!-- /react-text --><code data-reactid="73">localhost:8080/src/text.html?name=测试</code><!-- react-text: 74 -->。<!-- /react-text --></p><p data-reactid="75"><!-- react-text: 76 -->uri本身是采用ASCII编码的，所以如果是非 <!-- /react-text --><code data-reactid="77">ASCII</code><!-- react-text: 78 --> 编码集的字符在传输时都会被编码，编码方法和 <!-- /react-text --><code data-reactid="79">encodeURI</code><!-- react-text: 80 --> 的编码规则相同，但是这里的编码规则是由浏览器控制的，不同的浏览器采用的编码方式 <!-- /react-text --><code data-reactid="81">(UTF-8,GBK)</code><!-- react-text: 82 --> 不一样，被编码的数据发送给服务器，服务器用 <!-- /react-text --><code data-reactid="83">iso-8859-1</code><!-- react-text: 84 --> 编码对数据解码，后端人员通过 <!-- /react-text --><code data-reactid="85">request.getParameter(&quot;name&quot;)</code><!-- react-text: 86 --> 获取参数数据，且获得的数据都是经过解码过的，而解码过程中程序里无法指定，对于 <!-- /react-text --><code data-reactid="87">get</code><!-- react-text: 88 --> 请求获得的数据 <!-- /react-text --><code data-reactid="89">request.setCharacterEncoding(&quot;字符集&quot;)</code><!-- react-text: 90 --> 指定解码规则无效。<!-- /react-text --></p><p data-reactid="91"><!-- react-text: 92 -->如果是 <!-- /react-text --><code data-reactid="93">post</code><!-- react-text: 94 --> 方法传递数据，浏览器也会对数据进行编码，如果我们在 <!-- /react-text --><code data-reactid="95">ajax</code><!-- react-text: 96 --> 请求头里面设置了 <!-- /react-text --><code data-reactid="97">setRequestHeader(&quot;ContentType&quot;,&quot;application/x-www-form-urlencoded;charset=UTF-8&quot;)</code><!-- react-text: 98 -->; 浏览器就会以charset值进行编码，如果没有设置则由网页 <!-- /react-text --><code data-reactid="99">meta</code><!-- react-text: 100 --> 标签的 <!-- /react-text --><code data-reactid="101">charset</code><!-- react-text: 102 --> 属性决定，被编码过的数据发送给服务器，服务器用 <!-- /react-text --><code data-reactid="103">iso-8859-1</code><!-- react-text: 104 --> 编码对数据解码，对于post请求发来的数据后端人员可以使用 <!-- /react-text --><code data-reactid="105">request.setCharacterEncoding(&quot;字符集&quot;)</code><!-- react-text: 106 --> 指定解码规则。<!-- /react-text --></p><p data-reactid="107"><!-- react-text: 108 -->相信你已经找出了乱码的原因，由于 <!-- /react-text --><code data-reactid="109">get</code><!-- react-text: 110 --> 方法传的的数据，浏览器的转码规则和服务器的解码规则不一致出现了乱码，我们一般是怎么解决的呢？<!-- /react-text --><code data-reactid="111">get</code><!-- react-text: 112 --> 方式发送的数据如果有中文和特殊字符前端会先使用 <!-- /react-text --><code data-reactid="113">encodeURI()</code><!-- react-text: 114 --> 方法转码，这样 <!-- /react-text --><code data-reactid="115">url</code><!-- react-text: 116 --> 里面的就都是 <!-- /react-text --><code data-reactid="117">ASCII</code><!-- react-text: 118 --> 编码集的字符，省去了浏览器的转码，且 <!-- /react-text --><code data-reactid="119">encodeURI()</code><!-- react-text: 120 --> 的转码规则可控，受网页 <!-- /react-text --><code data-reactid="121">meta</code><!-- react-text: 122 --> 头的 <!-- /react-text --><code data-reactid="123">charset</code><!-- react-text: 124 --> 属性影响，<!-- /react-text --></p><ol data-reactid="125"><li data-reactid="126"><!-- react-text: 127 -->标签的 <!-- /react-text --><code data-reactid="128">charset</code><!-- react-text: 129 --> 属性为 <!-- /react-text --><code data-reactid="130">utf-8</code><!-- react-text: 131 --> 时：<!-- /react-text --></li></ol><pre data-reactid="132"><code data-query="{}" data-lang="data-lang" data-reactid="133">var data = &#x27;百度&amp;%$#@baidu&#x27;;
console.log(encodeURI(data));
// %E7%99%BE%E5%BA%A6&amp;%25$#@baidu
console.log(encodeURIComponent(data));
// %E7%99%BE%E5%BA%A6%26%25%24%23%40baidu
</code></pre><ol start="2" data-reactid="134"><li data-reactid="135"><!-- react-text: 136 -->标签的 <!-- /react-text --><code data-reactid="137">charset</code><!-- react-text: 138 --> 属性为 <!-- /react-text --><code data-reactid="139">GBK</code><!-- react-text: 140 --> 时：<!-- /react-text --></li></ol><pre data-reactid="141"><code data-query="{}" data-lang="data-lang" data-reactid="142">var data = &#x27;百度&amp;%$#@baidu&#x27;;
console.log(encodeURI(data));
// %E9%90%A7%E6%83%A7%E5%AE%B3&amp;%25$#@baidu
console.log(encodeURIComponent(data));
// %E9%90%A7%E6%83%A7%E5%AE%B3%26%25%24%23%40baidu
</code></pre><p data-reactid="143">后端人员获取到用iso-8859-1解码后的数据一般先还原回字节码，然后用前后端协定的方式解码数据，还可以在服务器的配置文件里面进行配置解码规则。而post请求发送的数据可以使用request.setCharacterEncoding(&quot;字符集&quot;)指定解码规则来达到前后端转码统一。</p><p data-reactid="144">当我们需要传递的数据量大，结构复杂，业务场景，技术实现需要的时候我们就又会发现，乱码的问题依然存在，比如</p><ul data-reactid="145"><li data-reactid="146">json格式的数据由于特殊字符导致数据解析出现问题，</li><li data-reactid="147">xml格式数据由于特殊字符破坏xml格式导致数据解析出现问题，</li><li data-reactid="148">前后端一些语言自带的转码方法对一些特殊字符转码结果不一致，以及并非所有特殊字符都会被转码...</li></ul><p data-reactid="149"><!-- react-text: 150 -->如果我们使用 <!-- /react-text --><code data-reactid="151">encodeURI</code><!-- react-text: 152 --> 或者 <!-- /react-text --><code data-reactid="153">encodeURIComponent</code><!-- react-text: 154 --> 编码传输到后端，后端解码之后的数据总会因为一些特殊字符的转码不一致导致结果不一样，如果再加上 <!-- /react-text --><code data-reactid="155">md5</code><!-- react-text: 156 --> 校验之类的，前端传递的数据就会因为 <!-- /react-text --><code data-reactid="157">md5</code><!-- react-text: 158 --> 不同无法解析入库。<!-- /react-text --></p><p data-reactid="159"><!-- react-text: 160 -->那么这个时候我们就该考虑有没有一种转码规则可以解决以上所有的问题呢？<!-- /react-text --><code data-reactid="161">base64</code><!-- react-text: 162 --> 转码你值得拥有。<!-- /react-text --></p><h3 id="base64转码" data-reactid="163"><a href="#base64%E8%BD%AC%E7%A0%81" aria-hidden="true" data-reactid="164"><span class="icon icon-link" data-reactid="165"></span></a><!-- react-text: 166 -->base64转码<!-- /react-text --></h3><p data-reactid="167"><code data-reactid="168">base64</code><!-- react-text: 169 --> 编码是从二进制到字符的过程，编码受 <!-- /react-text --><code data-reactid="170">html</code><!-- react-text: 171 --> 页面头部 <!-- /react-text --><code data-reactid="172">mate</code><!-- react-text: 173 -->;标签的 <!-- /react-text --><code data-reactid="174">charset</code><!-- react-text: 175 --> 属性影响，<!-- /react-text --><code data-reactid="176">charset</code><!-- react-text: 177 --> 属性不同，编码转为二进制时，产生的二进制也是不一样的，所以最终产生的 <!-- /react-text --><code data-reactid="178">base64</code><!-- react-text: 179 --> 字符也不一样。<!-- /react-text --></p><ol data-reactid="180"><li data-reactid="181"><code data-reactid="182">mate</code><!-- react-text: 183 --> 标签的 <!-- /react-text --><code data-reactid="184">charset</code><!-- react-text: 185 --> 属性为 <!-- /react-text --><code data-reactid="186">utf-8</code><!-- react-text: 187 --> 时：<!-- /react-text --></li></ol><pre data-reactid="188"><code data-query="{}" data-lang="data-lang" data-reactid="189">&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;en&quot;&gt;
&lt;head&gt;
&lt;meta charset=&quot;utf-8&quot;&gt;
&lt;title&gt;base64&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;script src=&quot;base64.min.js&quot;&gt;&lt;/script&gt;
&lt;script&gt;
var data = &#x27;百度&amp;%$#@baidu&#x27;;
console.log(base64encode(data));
// fqYmJSQjQGJhaWR1
&lt;/script&gt;
&lt;/body&gt;
</code></pre><ol start="2" data-reactid="190"><li data-reactid="191"><code data-reactid="192">mate</code><!-- react-text: 193 --> 标签的 <!-- /react-text --><code data-reactid="194">charset</code><!-- react-text: 195 --> 属性为 <!-- /react-text --><code data-reactid="196">GBK</code><!-- react-text: 197 --> 时：<!-- /react-text --></li></ol><pre data-reactid="198"><code data-query="{}" data-lang="data-lang" data-reactid="199">&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;en&quot;&gt;
&lt;head&gt;
&lt;meta charset=&quot;GBK&quot;&gt;
&lt;title&gt;base64&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;script src=&quot;base64.min.js&quot;&gt;&lt;/script&gt;
&lt;script&gt;
var data = &#x27;百度&amp;%$#@baidu&#x27;;
console.log(base64encode(data));
// J+ezJiUkI0BiYWlkdQ==
&lt;/script&gt;
&lt;/body&gt;
</code></pre><p data-reactid="200"><!-- react-text: 201 -->有关 <!-- /react-text --><code data-reactid="202">base64</code><!-- react-text: 203 --> 转码原理有兴趣可自行百科。<!-- /react-text --></p><h3 id="总结" data-reactid="204"><a href="#%E6%80%BB%E7%BB%93" aria-hidden="true" data-reactid="205"><span class="icon icon-link" data-reactid="206"></span></a><!-- react-text: 207 -->总结<!-- /react-text --></h3><p data-reactid="208"><!-- react-text: 209 -->所以工作中如果涉及到文本框输入等复杂的内容数据传递为了避免中文乱码以及各种特殊符号带来的困扰就使用 <!-- /react-text --><code data-reactid="210">base64</code><!-- react-text: 211 --> 转码传递。 如果只是URL里面的传递简单的参数可以使用 <!-- /react-text --><code data-reactid="212">encodeURI</code><!-- react-text: 213 --> 和 <!-- /react-text --><code data-reactid="214">encodeURIComponent</code><!-- react-text: 215 --> 等转码。<!-- /react-text --></p></article><div data-reactid="216"></div><nav class="single-bar clearfix" data-reactid="217"><span class="prev" data-reactid="218"><a rel="prev" href="/blog/fe/如何进行edm邮件制作" data-reactid="219"><em class="eux-icon eux-icon-page-prev" data-reactid="220"></em><!-- react-text: 221 -->如何进行EDM邮件制作<!-- /react-text --></a></span><span class="next" data-reactid="222"><a rel="next" href="/blog/fe/es6-对unicode的支持小结" data-reactid="223"><em class="eux-icon eux-icon-page-next" data-reactid="224"></em><!-- react-text: 225 -->ES6 对unicode的支持<!-- /react-text --></a></span></nav></div></div></div><footer class="footer" data-reactid="226"><div class="eux-footer-area-wrapper container-singular" role="complementary" data-reactid="227"><div class="inner clearfix" data-reactid="228"><aside id="simple-links-2" class="widget sl-links-main" data-reactid="229"><h2 class="widgettitle" data-reactid="230">友情链接</h2><ul class="simple-links-list simple-links-2-list" id="simple-links-2-list" data-reactid="231"><li class="simple-links-item simple-links-widget-item" id="link-379" data-reactid="232"><a target="_blank" href="http://sux.baidu.com/" title="百度 FEX 团队" data-reactid="233">百度 FEX</a></li><li class="simple-links-item simple-links-widget-item" id="link-379" data-reactid="234"><a target="_blank" href="http://efe.baidu.com/" title="百度 EFE 团队" data-reactid="235">百度 EFE</a></li><li class="simple-links-item simple-links-widget-item" id="link-379" data-reactid="236"><a target="_blank" href="http://sux.baidu.com/" title="百度 SUX 团队" data-reactid="237">百度 SUX</a></li><li class="simple-links-item simple-links-widget-item" id="link-379" data-reactid="238"><a target="_blank" href="https://aotu.io/" title="京东凹凸实验室，面向多终端技术体系，致力于构建沉淀与分享包括但不限于交互、页面制作技巧、前端开发、原生APP开发等方面的专业知识及案例。" data-reactid="239">凹凸实验室</a></li><li class="simple-links-item simple-links-widget-item" id="link-379" data-reactid="240"><a target="_blank" href="https://fed.renren.com/" title="人人网FED" data-reactid="241">人人网FED</a></li></ul></aside></div></div><div class="eux-icp" data-reactid="242"><!-- react-text: 243 -->百度EUX 版权所有 ©百度EUX    All rights reserved. 骄傲地采用 <!-- /react-text --><a target="_blank" href="https://github.com/picidaejs/picidaejs" data-reactid="244">Picidae</a><!-- react-text: 245 -->。<!-- /react-text --></div></footer></div>
</div>
<script src="/PICIDAE_COMMON.js"></script>
<script src="/PICIDAE_ENTRY.js"></script>
</body>
</html>