<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title> 实现高度内容自适应的 textarea | 百度EUX </title>
    <link rel="stylesheet" href="/style.css">
    <script>
      (function() {
        var hm = document.createElement("script");
        hm.src = "//hm.baidu.com/hm.js?d232748d06c1fe09a6db3db0077669b7";
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);
      })();

      var _vds = _vds || [];
      window._vds = _vds;
      (function () {
        _vds.push(['setAccountId', '66707fb8b27442d5b3ccca57a56800fa']);
        _vds.push(['trackBot', false]);

        (function () {
          var vds = document.createElement('script');
          vds.type = 'text/javascript';
          vds.async = true;
          vds.src = '//dn-growing.qbox.me/vds.js';
          var s = document.getElementsByTagName('script')[0];
          s.parentNode.insertBefore(vds, s);
        })();
      })();
    </script>
</head>
<body>
<div id="root">
    <div class="main" data-reactroot="" data-reactid="1" data-react-checksum="-2126286899"><!-- react-empty: 2 --><header class="eux-header clearfix" data-reactid="3"><div class="eux-header-top" data-reactid="4"><a href="javascript:void(0);" class="eux-portable-menu" data-reactid="5"><span data-reactid="6"></span><span data-reactid="7"></span><span data-reactid="8"></span></a><!-- react-empty: 9 --><nav class="menu-primary-container" data-reactid="10"><ul id="menu-primary" class="menu" data-reactid="11"><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-25" data-reactid="12"><a href="/" data-reactid="13">HOME</a></li><li class="menu-item menu-item-type-custom menu-item-object-custom current-menu-ancestor current-menu-parent menu-item-has-children menu-item-45" data-reactid="14"><a href="/" data-reactid="15">BLOG</a><ul class="sub-menu" data-reactid="16"><li class="menu-item menu-item-type-taxonomy menu-item-object-category current-menu-item menu-item-63" data-reactid="17"><a href="/ue" data-reactid="18">交互</a></li><li class="menu-item menu-item-type-taxonomy menu-item-object-category current-menu-item menu-item-63" data-reactid="19"><a href="/ui" data-reactid="20">视觉</a></li><li class="menu-item menu-item-type-taxonomy menu-item-object-category current-menu-item menu-item-63" data-reactid="21"><a href="/fe" data-reactid="22">前端</a></li><li class="menu-item menu-item-type-taxonomy menu-item-object-category current-menu-item menu-item-63" data-reactid="23"><a href="/team" data-reactid="24">团队</a></li></ul></li><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-46" data-reactid="25"><a href="/tools" data-reactid="26">TOOLS</a></li><li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-112" data-reactid="27"><a href="/works" data-reactid="28">WORKS</a></li><li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-138" data-reactid="29"><a href="/jobs" data-reactid="30">JOBS</a></li><li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-50" data-reactid="31"><a href="/about-us" data-reactid="32">ABOUT US</a></li></ul></nav></div></header><div class="eux-singular clearfix" data-reactid="33"><div class="container-singular clearfix" data-reactid="34"><nav class="menu-categories-container" data-reactid="35"><ul id="menu-categories" class="menu" data-reactid="36"><li class="menu-item menu-item-type-custom menu-item-object-custom current_page_item menu-item-55" data-reactid="37"><span data-reactid="38"><a href="/" data-reactid="39">全部</a></span></li><li class="menu-item menu-item-type-custom menu-item-object-custom current_page_item menu-item-55" data-reactid="40"><span data-reactid="41"><a href="/ue" data-reactid="42">交互</a></span></li><li class="menu-item menu-item-type-custom menu-item-object-custom current_page_item menu-item-55" data-reactid="43"><span data-reactid="44"><a href="/ui" data-reactid="45">视觉</a></span></li><li class="current-menu-item menu-item menu-item-type-custom menu-item-object-custom current_page_item menu-item-55" data-reactid="46"><span data-reactid="47"><a href="/fe" data-reactid="48">前端</a></span></li><li class="menu-item menu-item-type-custom menu-item-object-custom current_page_item menu-item-55" data-reactid="49"><span data-reactid="50"><a href="/team" data-reactid="51">团队</a></span></li></ul></nav><div class="inner clearfix" data-reactid="52"><div class="article-meta" data-reactid="53"><h1 class="title" data-reactid="54">实现高度内容自适应的 textarea</h1><div class="eux-page-detail" data-reactid="55"><span data-reactid="56"><em data-reactid="57">by.</em><!-- react-text: 58 -->张庭岑<!-- /react-text --></span><span data-reactid="59">2018-6-7</span></div></div><article data-reactid="60"><h2 id="背景介绍" data-reactid="61"><a href="#%E8%83%8C%E6%99%AF%E4%BB%8B%E7%BB%8D" aria-hidden="true" data-reactid="62"><span class="icon icon-link" data-reactid="63"></span></a><!-- react-text: 64 -->背景介绍<!-- /react-text --></h2><p data-reactid="65"><!-- react-text: 66 -->正如我们所知道的 <!-- /react-text --><code data-reactid="67">textarea</code><!-- react-text: 68 --> 是一个行内块元素 <!-- /react-text --><code data-reactid="69">display: inline-block</code><!-- react-text: 70 --> 并且它的默认宽高由 <!-- /react-text --><code data-reactid="71">cols</code><!-- react-text: 72 --> &amp; <!-- /react-text --><code data-reactid="73">rows</code><!-- react-text: 74 --> 决定, 也就是说 <!-- /react-text --><code data-reactid="75">textarea</code><!-- react-text: 76 --> 的 <!-- /react-text --><code data-reactid="77">height</code><!-- react-text: 78 --> 并不会自适应于内容长度.<!-- /react-text --></p><p data-reactid="79"><strong data-reactid="80"><em data-reactid="81">textarea</em><!-- react-text: 82 --> 的宽高是如何决定的?<!-- /react-text --></strong><!-- react-text: 83 --> 参考张鑫旭的文章 <!-- /react-text --><a href="http://www.zhangxinxu.com/wordpress/2016/02/html-textarea-rows-height/" data-reactid="84">HTML textarea cols,rows属性和宽度高度关系研究</a></p><p data-reactid="85"><!-- react-text: 86 -->那么, 我们今天的任务就是来思考如何创建一个 <!-- /react-text --><strong data-reactid="87"><!-- react-text: 88 -->高度内容自适应的 <!-- /react-text --><em data-reactid="89">textarea</em><!-- react-text: 90 --> 组件<!-- /react-text --></strong><!-- react-text: 91 -->，我将介绍三种思路实现 <!-- /react-text --><strong data-reactid="92"><!-- react-text: 93 -->高度内容自适应的 <!-- /react-text --><em data-reactid="94">textarea</em></strong><!-- react-text: 95 -->，具体代码 <!-- /react-text --><a href="https://github.com/teeeemoji/TextareaAutoSizeSolutions" data-reactid="96">textareaAutoSizeSolutions</a></p><h2 id="方案概要" data-reactid="97"><a href="#%E6%96%B9%E6%A1%88%E6%A6%82%E8%A6%81" aria-hidden="true" data-reactid="98"><span class="icon icon-link" data-reactid="99"></span></a><!-- react-text: 100 -->方案概要<!-- /react-text --></h2><p data-reactid="101"><!-- react-text: 102 -->这是三种方案的概述和实现思路的简介, 实现方案 &amp; 遇到的坑 &amp; 拓展知识点, 点击查看 <!-- /react-text --><a href="https://github.com/teeeemoji/TextareaAutoSizeSolutions" data-reactid="103">teeeemoji 的 demo</a><!-- react-text: 104 -->.<!-- /react-text --></p><h3 id="方案一-两次调整-textareastyleheight" data-reactid="105"><a href="#%E6%96%B9%E6%A1%88%E4%B8%80-%E4%B8%A4%E6%AC%A1%E8%B0%83%E6%95%B4-textareastyleheight" aria-hidden="true" data-reactid="106"><span class="icon icon-link" data-reactid="107"></span></a><!-- react-text: 108 -->方案一: 两次调整 textarea.style.height<!-- /react-text --></h3><p data-reactid="109"><code data-reactid="110">textarea</code><!-- react-text: 111 --> 的 <!-- /react-text --><code data-reactid="112">onchange</code><!-- react-text: 113 --> 触发 <!-- /react-text --><code data-reactid="114">resize</code><!-- react-text: 115 --> 方法，下面是 <!-- /react-text --><code data-reactid="116">resize</code><!-- react-text: 117 --> 方法的逻辑<!-- /react-text --></p><pre data-reactid="118"><code class="hljs language-javascript" data-query="{}" data-lang="javascript" data-reactid="119"><!-- react-text: 120 -->textarea.style.height = <!-- /react-text --><span class="hljs-string" data-reactid="121">&#x27;auto&#x27;</span><!-- react-text: 122 -->;<!-- /react-text --><span class="hljs-comment" data-reactid="123">// 1. 让 textarea 的高度恢复默认</span><!-- react-text: 124 -->
textarea.style.height = textarea.scrollHeight + <!-- /react-text --><span class="hljs-string" data-reactid="125">&#x27;px&#x27;</span><!-- react-text: 126 -->;<!-- /react-text --><span class="hljs-comment" data-reactid="127">// 2. textarea.scrollHeight 表示 *textarea* 内容的实际高度</span></code></pre><h3 id="方案二-利用一个-ghosttextarea-获得输入框内容高度-再将这个高度设置给真实的-textarea" data-reactid="128"><a href="#%E6%96%B9%E6%A1%88%E4%BA%8C-%E5%88%A9%E7%94%A8%E4%B8%80%E4%B8%AA-ghosttextarea-%E8%8E%B7%E5%BE%97%E8%BE%93%E5%85%A5%E6%A1%86%E5%86%85%E5%AE%B9%E9%AB%98%E5%BA%A6-%E5%86%8D%E5%B0%86%E8%BF%99%E4%B8%AA%E9%AB%98%E5%BA%A6%E8%AE%BE%E7%BD%AE%E7%BB%99%E7%9C%9F%E5%AE%9E%E7%9A%84-textarea" aria-hidden="true" data-reactid="129"><span class="icon icon-link" data-reactid="130"></span></a><!-- react-text: 131 -->方案二: 利用一个 ghostTextarea 获得输入框内容高度, 再将这个高度设置给真实的 <!-- /react-text --><em data-reactid="132">textarea</em></h3><p data-reactid="133"><code data-reactid="134">textarea</code><!-- react-text: 135 --> 构建时创建 <!-- /react-text --><strong data-reactid="136">ghostTextarea</strong><!-- react-text: 137 -->, <!-- /react-text --><code data-reactid="138">onchange</code><!-- react-text: 139 --> 触发 <!-- /react-text --><code data-reactid="140">resize</code><!-- react-text: 141 --> 方法：<!-- /react-text --></p><ol data-reactid="142"><li data-reactid="143"><!-- react-text: 144 -->创建 <!-- /react-text --><em data-reactid="145">textarea</em><!-- react-text: 146 --> 的时候, 同时创建一个一模一样的隐藏 ghostTextarea;<!-- /react-text --></li><li data-reactid="147"><!-- react-text: 148 -->ghostTextarea 的属性全部克隆自 <!-- /react-text --><code data-reactid="149">textarea</code><!-- react-text: 150 -->, 但是 ghostTextarea 是 <!-- /react-text --><strong data-reactid="151">隐藏</strong><!-- react-text: 152 --> 的, 并且 <!-- /react-text --><code data-reactid="153">ghostTextarea.style.height = 0</code><!-- react-text: 154 -->; 也就是说 ghostTextarea.scrollHeight 就是 <!-- /react-text --><code data-reactid="155">textarea</code><!-- react-text: 156 --> 中内容的真是高度。<!-- /react-text --></li></ol><p data-reactid="157">resize 方法处理流程：</p><ol data-reactid="158"><li data-reactid="159"><code data-reactid="160">textarea.value</code><!-- react-text: 161 --> 先设置给 ghostTextarea,<!-- /react-text --></li><li data-reactid="162"><!-- react-text: 163 -->拿到 <!-- /react-text --><code data-reactid="164">ghostTextarea.scrollHeight</code></li><li data-reactid="165"><!-- react-text: 166 -->将 <!-- /react-text --><code data-reactid="167">textarea.style.height = ghostTextarea.scrollHeight</code></li></ol><h3 id="方案三-使用-div--p--contenteditable-代替-textarea-作为输入框" data-reactid="168"><a href="#%E6%96%B9%E6%A1%88%E4%B8%89-%E4%BD%BF%E7%94%A8-div--p--contenteditable-%E4%BB%A3%E6%9B%BF-textarea-%E4%BD%9C%E4%B8%BA%E8%BE%93%E5%85%A5%E6%A1%86" aria-hidden="true" data-reactid="169"><span class="icon icon-link" data-reactid="170"></span></a><!-- react-text: 171 -->方案三: 使用 (div | p | ...).contenteditable 代替 <!-- /react-text --><em data-reactid="172">textarea</em><!-- react-text: 173 --> 作为输入框<!-- /react-text --></h3><p data-reactid="174"><code data-reactid="175">div</code><!-- react-text: 176 --> 是块级元素, 高度本身就是内容自适应的（除非设置 <!-- /react-text --><code data-reactid="177">max-width</code><!-- react-text: 178 --> or <!-- /react-text --><code data-reactid="179">min-widht</code><!-- react-text: 180 -->） 使用 <!-- /react-text --><code data-reactid="181">contenteditable</code><!-- react-text: 182 --> 让 <!-- /react-text --><code data-reactid="183">div</code><!-- react-text: 184 --> 代替 <!-- /react-text --><code data-reactid="185">textarea</code><!-- react-text: 186 -->, 省去各种计算高度的逻辑。<!-- /react-text --></p><h2 id="方案对比" data-reactid="187"><a href="#%E6%96%B9%E6%A1%88%E5%AF%B9%E6%AF%94" aria-hidden="true" data-reactid="188"><span class="icon icon-link" data-reactid="189"></span></a><!-- react-text: 190 -->方案对比<!-- /react-text --></h2><p data-reactid="191">满分3分, 三种方案通过优化, 在用户体验和兼容性上都能达到满分. 因此差别仅仅在于这几个方案的实现难度. (仅仅是基于 react 组件的实现复杂度). 方案对比：</p><img src="https://eux-public.bj.bcebos.com/2018/06/07/34596181d6d29cff57903f61b.png" alt="alt" width="656" height="173" data-reactid="192"/><p data-reactid="193">毫无疑问方案一是最优选择, 多加1分以示奖励;</p><h2 id="方案一两次调整-textareastyleheight" data-reactid="194"><a href="#%E6%96%B9%E6%A1%88%E4%B8%80%E4%B8%A4%E6%AC%A1%E8%B0%83%E6%95%B4-textareastyleheight" aria-hidden="true" data-reactid="195"><span class="icon icon-link" data-reactid="196"></span></a><!-- react-text: 197 -->方案一两次调整 textarea.style.height<!-- /react-text --></h2><h3 id="实现思路" data-reactid="198"><a href="#%E5%AE%9E%E7%8E%B0%E6%80%9D%E8%B7%AF" aria-hidden="true" data-reactid="199"><span class="icon icon-link" data-reactid="200"></span></a><!-- react-text: 201 -->实现思路<!-- /react-text --></h3><ol data-reactid="202"><li data-reactid="203"><!-- react-text: 204 -->渲染一个 <!-- /react-text --><code data-reactid="205">textarea</code><!-- react-text: 206 --> 元素<!-- /react-text --></li></ol><pre data-reactid="207"><code class="hljs language-javascript" data-query="{}" data-lang="javascript" data-reactid="208"><!-- react-text: 209 -->&lt;textarea
    ref={<!-- /react-text --><span class="hljs-keyword" data-reactid="210">this</span><!-- react-text: 211 -->.bindRef}
    className={style[<!-- /react-text --><span class="hljs-string" data-reactid="212">&#x27;textarea&#x27;</span><!-- react-text: 213 -->] + <!-- /react-text --><span class="hljs-string" data-reactid="214">&#x27; &#x27;</span><!-- react-text: 215 --> + className}
    placeholder={placeholder}
    value={value}
    onChange={<!-- /react-text --><span class="hljs-keyword" data-reactid="216">this</span><!-- react-text: 217 -->.handleChange} <!-- /react-text --><span class="hljs-comment" data-reactid="218">// 看这里</span><!-- react-text: 219 -->
/&gt;<!-- /react-text --></code></pre><ol start="2" data-reactid="220"><li data-reactid="221"><code data-reactid="222">textarea</code><!-- react-text: 223 --> 的 <!-- /react-text --><code data-reactid="224">onChange</code><!-- react-text: 225 --> 事件触发 <!-- /react-text --><code data-reactid="226">resize</code></li></ol><pre data-reactid="227"><code class="hljs language-javascript" data-query="{}" data-lang="javascript" data-reactid="228"><!-- react-text: 229 -->handleChange(e) {
    <!-- /react-text --><span class="hljs-keyword" data-reactid="230">this</span><!-- react-text: 231 -->.props.onChange(e.target.value);
    <!-- /react-text --><span class="hljs-keyword" data-reactid="232">this</span><!-- react-text: 233 -->.resize();	<!-- /react-text --><span class="hljs-comment" data-reactid="234">// 看这里</span><!-- react-text: 235 -->
}<!-- /react-text --></code></pre><ol start="3" data-reactid="236"><li data-reactid="237"><code data-reactid="238">resize</code><!-- react-text: 239 --> 事件的实现<!-- /react-text --></li></ol><pre data-reactid="240"><code class="hljs language-javascript" data-query="{}" data-lang="javascript" data-reactid="241"><span class="hljs-comment" data-reactid="242">// 重新计算 textarea 的高度</span><!-- react-text: 243 -->
resize() {
    <!-- /react-text --><span class="hljs-keyword" data-reactid="244">if</span><!-- react-text: 245 --> (<!-- /react-text --><span class="hljs-keyword" data-reactid="246">this</span><!-- react-text: 247 -->.inputRef) {
        <!-- /react-text --><span class="hljs-built_in" data-reactid="248">console</span><!-- react-text: 249 -->.log(<!-- /react-text --><span class="hljs-string" data-reactid="250">&#x27;resizing...&#x27;</span><!-- react-text: 251 -->)
        <!-- /react-text --><span class="hljs-keyword" data-reactid="252">this</span><!-- react-text: 253 -->.inputRef.style.height = <!-- /react-text --><span class="hljs-string" data-reactid="254">&#x27;auto&#x27;</span><!-- react-text: 255 -->;
        <!-- /react-text --><span class="hljs-keyword" data-reactid="256">this</span><!-- react-text: 257 -->.inputRef.style.height = <!-- /react-text --><span class="hljs-keyword" data-reactid="258">this</span><!-- react-text: 259 -->.inputRef.scrollHeight + <!-- /react-text --><span class="hljs-string" data-reactid="260">&#x27;px&#x27;</span><!-- react-text: 261 -->;
    }
}<!-- /react-text --></code></pre><ol start="4" data-reactid="262"><li data-reactid="263"><!-- react-text: 264 -->注意 <!-- /react-text --><code data-reactid="265">componentDidMount</code><!-- react-text: 266 --> 的时候, 执行一次 <!-- /react-text --><code data-reactid="267">resize</code><!-- react-text: 268 --> 方法, 初始化 <!-- /react-text --><code data-reactid="269">textarea</code><!-- react-text: 270 --> 的高度哦.<!-- /react-text --></li></ol><h3 id="优化点" data-reactid="271"><a href="#%E4%BC%98%E5%8C%96%E7%82%B9" aria-hidden="true" data-reactid="272"><span class="icon icon-link" data-reactid="273"></span></a><!-- react-text: 274 -->优化点<!-- /react-text --></h3><p data-reactid="275"><strong data-reactid="276">避免两次渲染,造成内容抖动</strong></p><p data-reactid="277"><!-- react-text: 278 -->在 <!-- /react-text --><code data-reactid="279">react</code><!-- react-text: 280 --> 中, 组件 <!-- /react-text --><code data-reactid="281">receiveProps</code><!-- react-text: 282 --> 的时候会 <!-- /react-text --><code data-reactid="283">render</code><!-- react-text: 284 --> 一次, 直接调整 <!-- /react-text --><code data-reactid="285">textarea</code><!-- react-text: 286 --> 的 <!-- /react-text --><code data-reactid="287">height</code><!-- react-text: 288 --> 也会浏览器的重绘，那么就会造成两次重绘, 并且两次重绘的时候, <!-- /react-text --><code data-reactid="289">textarea</code><!-- react-text: 290 --> 的内容可能会发生抖动.<!-- /react-text --></p><p data-reactid="291"><strong data-reactid="292">优化思路</strong><!-- react-text: 293 -->：先触发 <!-- /react-text --><code data-reactid="294">resize</code><!-- react-text: 295 --> 后触发 <!-- /react-text --><code data-reactid="296">render</code><!-- react-text: 297 --> <!-- /react-text --><strong data-reactid="298">用最简单的思路完美解决问题</strong></p><h2 id="方案二-利用一个-ghosttextarea-获得输入框内容高度-再将这个高度设置给真实的-textarea-1" data-reactid="299"><a href="#%E6%96%B9%E6%A1%88%E4%BA%8C-%E5%88%A9%E7%94%A8%E4%B8%80%E4%B8%AA-ghosttextarea-%E8%8E%B7%E5%BE%97%E8%BE%93%E5%85%A5%E6%A1%86%E5%86%85%E5%AE%B9%E9%AB%98%E5%BA%A6-%E5%86%8D%E5%B0%86%E8%BF%99%E4%B8%AA%E9%AB%98%E5%BA%A6%E8%AE%BE%E7%BD%AE%E7%BB%99%E7%9C%9F%E5%AE%9E%E7%9A%84-textarea-1" aria-hidden="true" data-reactid="300"><span class="icon icon-link" data-reactid="301"></span></a><!-- react-text: 302 -->方案二: 利用一个 ghostTextarea 获得输入框内容高度, 再将这个高度设置给真实的 <!-- /react-text --><em data-reactid="303">textarea</em></h2><h3 id="实现思路-1" data-reactid="304"><a href="#%E5%AE%9E%E7%8E%B0%E6%80%9D%E8%B7%AF-1" aria-hidden="true" data-reactid="305"><span class="icon icon-link" data-reactid="306"></span></a><!-- react-text: 307 -->实现思路<!-- /react-text --></h3><p data-reactid="308"><!-- react-text: 309 -->同时渲染两个 <!-- /react-text --><code data-reactid="310">textarea</code><!-- react-text: 311 -->, 一个真实 <!-- /react-text --><code data-reactid="312">textarea</code><!-- react-text: 313 --> 一个隐藏 <!-- /react-text --><code data-reactid="314">textarea</code></p><pre data-reactid="315"><code class="hljs language-javascript" data-query="{}" data-lang="javascript" data-reactid="316"><span class="hljs-keyword" data-reactid="317">return</span><!-- react-text: 318 --> (
    <!-- /react-text --><span class="xml" data-reactid="319"><span class="hljs-tag" data-reactid="320"><!-- react-text: 321 -->&lt;<!-- /react-text --><span class="hljs-name" data-reactid="322">div</span><!-- react-text: 323 --> <!-- /react-text --><span class="hljs-attr" data-reactid="324">className</span><!-- react-text: 325 -->=<!-- /react-text --><span class="hljs-string" data-reactid="326">{style[</span><!-- react-text: 327 -->&#x27;<!-- /react-text --><span class="hljs-attr" data-reactid="328">comp-textarea-with-ghost</span><!-- react-text: 329 -->&#x27;]}&gt;<!-- /react-text --></span><!-- react-text: 330 -->
        <!-- /react-text --></span><!-- react-text: 331 -->&lt;textarea // 这个是真的
            ref={this.bindRef}
            className={style[&#x27;textarea&#x27;] + &#x27; &#x27; + className}
            placeholder={placeholder}
            value={value}
            onChange={this.handleChange}
            style={{height}}
        /&gt;
        &lt;textarea // 这个是 ghostTextarea
            className={style[&#x27;textarea-ghost&#x27;]}
            ref={this.bindGhostRef}
            onChange={noop}
        /&gt;
    &lt;/div&gt;
)<!-- /react-text --></code></pre><p data-reactid="332"><!-- react-text: 333 -->初始化的时候拷贝属性，初始化必须使用工具方法将 <!-- /react-text --><code data-reactid="334">textarea</code><!-- react-text: 335 --> 的属性拷贝到 <!-- /react-text --><code data-reactid="336">ghostTextarea</code><!-- react-text: 337 --> 去. 因为 <!-- /react-text --><code data-reactid="338">textarea</code><!-- react-text: 339 --> 的样式再组件外也能控制, 因此初始化的时候 copy style 是最安全的。<!-- /react-text --></p><p data-reactid="340">这是所以要拷贝的属性的列表:</p><pre data-reactid="341"><code class="hljs language-javascript" data-query="{}" data-lang="javascript" data-reactid="342"><span class="hljs-keyword" data-reactid="343">const</span><!-- react-text: 344 --> SIZING_STYLE = [
	<!-- /react-text --><span class="hljs-string" data-reactid="345">&#x27;letter-spacing&#x27;</span><!-- react-text: 346 -->,
	<!-- /react-text --><span class="hljs-string" data-reactid="347">&#x27;line-height&#x27;</span><!-- react-text: 348 -->,
	<!-- /react-text --><span class="hljs-string" data-reactid="349">&#x27;font-family&#x27;</span><!-- react-text: 350 -->,
	<!-- /react-text --><span class="hljs-string" data-reactid="351">&#x27;font-weight&#x27;</span><!-- react-text: 352 -->,
	<!-- /react-text --><span class="hljs-string" data-reactid="353">&#x27;font-size&#x27;</span><!-- react-text: 354 -->,
	<!-- /react-text --><span class="hljs-string" data-reactid="355">&#x27;font-style&#x27;</span><!-- react-text: 356 -->,
	<!-- /react-text --><span class="hljs-string" data-reactid="357">&#x27;tab-size&#x27;</span><!-- react-text: 358 -->,
	<!-- /react-text --><span class="hljs-string" data-reactid="359">&#x27;text-rendering&#x27;</span><!-- react-text: 360 -->,
	<!-- /react-text --><span class="hljs-string" data-reactid="361">&#x27;text-transform&#x27;</span><!-- react-text: 362 -->,
	<!-- /react-text --><span class="hljs-string" data-reactid="363">&#x27;width&#x27;</span><!-- react-text: 364 -->,
	<!-- /react-text --><span class="hljs-string" data-reactid="365">&#x27;text-indent&#x27;</span><!-- react-text: 366 -->,
	<!-- /react-text --><span class="hljs-string" data-reactid="367">&#x27;padding-top&#x27;</span><!-- react-text: 368 -->,
	<!-- /react-text --><span class="hljs-string" data-reactid="369">&#x27;padding-right&#x27;</span><!-- react-text: 370 -->,
	<!-- /react-text --><span class="hljs-string" data-reactid="371">&#x27;padding-bottom&#x27;</span><!-- react-text: 372 -->,
	<!-- /react-text --><span class="hljs-string" data-reactid="373">&#x27;padding-left&#x27;</span><!-- react-text: 374 -->,
	<!-- /react-text --><span class="hljs-string" data-reactid="375">&#x27;border-top-width&#x27;</span><!-- react-text: 376 -->,
	<!-- /react-text --><span class="hljs-string" data-reactid="377">&#x27;border-right-width&#x27;</span><!-- react-text: 378 -->,
	<!-- /react-text --><span class="hljs-string" data-reactid="379">&#x27;border-bottom-width&#x27;</span><!-- react-text: 380 -->,
	<!-- /react-text --><span class="hljs-string" data-reactid="381">&#x27;border-left-width&#x27;</span><!-- react-text: 382 -->,
	<!-- /react-text --><span class="hljs-string" data-reactid="383">&#x27;box-sizing&#x27;</span><!-- react-text: 384 -->
];<!-- /react-text --></code></pre><p data-reactid="385">这是 ghostTextarea 的隐藏属性列表:</p><pre data-reactid="386"><code class="hljs language-javascript" data-query="{}" data-lang="javascript" data-reactid="387"><span class="hljs-keyword" data-reactid="388">const</span><!-- react-text: 389 --> HIDDEN_TEXTAREA_STYLE = {
	<!-- /react-text --><span class="hljs-string" data-reactid="390">&#x27;min-height&#x27;</span><!-- react-text: 391 -->: <!-- /react-text --><span class="hljs-string" data-reactid="392">&#x27;0&#x27;</span><!-- react-text: 393 -->,
	<!-- /react-text --><span class="hljs-string" data-reactid="394">&#x27;max-height&#x27;</span><!-- react-text: 395 -->: <!-- /react-text --><span class="hljs-string" data-reactid="396">&#x27;none&#x27;</span><!-- react-text: 397 -->,
	<!-- /react-text --><span class="hljs-attr" data-reactid="398">height</span><!-- react-text: 399 -->: <!-- /react-text --><span class="hljs-string" data-reactid="400">&#x27;0&#x27;</span><!-- react-text: 401 -->,
	<!-- /react-text --><span class="hljs-attr" data-reactid="402">visibility</span><!-- react-text: 403 -->: <!-- /react-text --><span class="hljs-string" data-reactid="404">&#x27;hidden&#x27;</span><!-- react-text: 405 -->,
	<!-- /react-text --><span class="hljs-attr" data-reactid="406">overflow</span><!-- react-text: 407 -->: <!-- /react-text --><span class="hljs-string" data-reactid="408">&#x27;hidden&#x27;</span><!-- react-text: 409 -->,
	<!-- /react-text --><span class="hljs-attr" data-reactid="410">position</span><!-- react-text: 411 -->: <!-- /react-text --><span class="hljs-string" data-reactid="412">&#x27;absolute&#x27;</span><!-- react-text: 413 -->,
	<!-- /react-text --><span class="hljs-string" data-reactid="414">&#x27;z-index&#x27;</span><!-- react-text: 415 -->: <!-- /react-text --><span class="hljs-string" data-reactid="416">&#x27;-1000&#x27;</span><!-- react-text: 417 -->,
	<!-- /react-text --><span class="hljs-attr" data-reactid="418">top</span><!-- react-text: 419 -->: <!-- /react-text --><span class="hljs-string" data-reactid="420">&#x27;0&#x27;</span><!-- react-text: 421 -->,
	<!-- /react-text --><span class="hljs-attr" data-reactid="422">right</span><!-- react-text: 423 -->: <!-- /react-text --><span class="hljs-string" data-reactid="424">&#x27;0&#x27;</span><!-- react-text: 425 -->,
};<!-- /react-text --></code></pre><p data-reactid="426"><!-- react-text: 427 -->这是拷贝 <!-- /react-text --><code data-reactid="428">style</code><!-- react-text: 429 --> 的工具方法<!-- /react-text --></p><pre data-reactid="430"><code class="hljs language-javascript" data-query="{}" data-lang="javascript" data-reactid="431"><span class="hljs-comment" data-reactid="432">// 拿到真实 textarea 的所有 style</span><!-- react-text: 433 -->
<!-- /react-text --><span class="hljs-function" data-reactid="434"><span class="hljs-keyword" data-reactid="435">function</span><!-- react-text: 436 --> <!-- /react-text --><span class="hljs-title" data-reactid="437">calculateNodeStyling</span><!-- react-text: 438 -->(<!-- /react-text --><span class="hljs-params" data-reactid="439">node</span><!-- react-text: 440 -->) <!-- /react-text --></span><!-- react-text: 441 -->{
	<!-- /react-text --><span class="hljs-keyword" data-reactid="442">const</span><!-- react-text: 443 --> style = <!-- /react-text --><span class="hljs-built_in" data-reactid="444">window</span><!-- react-text: 445 -->.getComputedStyle(node);
	<!-- /react-text --><span class="hljs-keyword" data-reactid="446">if</span><!-- react-text: 447 --> (style === <!-- /react-text --><span class="hljs-literal" data-reactid="448">null</span><!-- react-text: 449 -->) {
		<!-- /react-text --><span class="hljs-keyword" data-reactid="450">return</span><!-- react-text: 451 --> <!-- /react-text --><span class="hljs-literal" data-reactid="452">null</span><!-- react-text: 453 -->;
	}
	<!-- /react-text --><span class="hljs-keyword" data-reactid="454">return</span><!-- react-text: 455 --> SIZING_STYLE.reduce(<!-- /react-text --><span class="hljs-function" data-reactid="456"><!-- react-text: 457 -->(<!-- /react-text --><span class="hljs-params" data-reactid="458">obj, name</span><!-- react-text: 459 -->) =&gt;<!-- /react-text --></span><!-- react-text: 460 --> {
		obj[name] = style.getPropertyValue(name);
			<!-- /react-text --><span class="hljs-keyword" data-reactid="461">return</span><!-- react-text: 462 --> obj;
	}, {});
}

<!-- /react-text --><span class="hljs-comment" data-reactid="463">// 拷贝 真实 textarea 的 style 到 ghostTextarea</span><!-- react-text: 464 -->
<!-- /react-text --><span class="hljs-keyword" data-reactid="465">export</span><!-- react-text: 466 --> <!-- /react-text --><span class="hljs-keyword" data-reactid="467">const</span><!-- react-text: 468 --> copyStyle = <!-- /react-text --><span class="hljs-function" data-reactid="469"><span class="hljs-keyword" data-reactid="470">function</span><!-- react-text: 471 --> (<!-- /react-text --><span class="hljs-params" data-reactid="472">toNode, fromNode</span><!-- react-text: 473 -->) <!-- /react-text --></span><!-- react-text: 474 -->{
	<!-- /react-text --><span class="hljs-keyword" data-reactid="475">const</span><!-- react-text: 476 --> nodeStyling = calculateNodeStyling(fromNode);
	<!-- /react-text --><span class="hljs-keyword" data-reactid="477">if</span><!-- react-text: 478 --> (nodeStyling === <!-- /react-text --><span class="hljs-literal" data-reactid="479">null</span><!-- react-text: 480 -->) {
		<!-- /react-text --><span class="hljs-keyword" data-reactid="481">return</span><!-- react-text: 482 --> <!-- /react-text --><span class="hljs-literal" data-reactid="483">null</span><!-- react-text: 484 -->;
	}
	<!-- /react-text --><span class="hljs-built_in" data-reactid="485">Object</span><!-- react-text: 486 -->.keys(nodeStyling).forEach(<!-- /react-text --><span class="hljs-function" data-reactid="487"><span class="hljs-params" data-reactid="488">key</span><!-- react-text: 489 --> =&gt;<!-- /react-text --></span><!-- react-text: 490 --> {
		toNode.style[key] = nodeStyling[key];
	});
	<!-- /react-text --><span class="hljs-built_in" data-reactid="491">Object</span><!-- react-text: 492 -->.keys(HIDDEN_TEXTAREA_STYLE).forEach(<!-- /react-text --><span class="hljs-function" data-reactid="493"><span class="hljs-params" data-reactid="494">key</span><!-- react-text: 495 --> =&gt;<!-- /react-text --></span><!-- react-text: 496 --> {
		toNode.style.setProperty(
			key,
			HIDDEN_TEXTAREA_STYLE[key],
			<!-- /react-text --><span class="hljs-string" data-reactid="497">&#x27;important&#x27;</span><!-- react-text: 498 -->,
		);
	});
}<!-- /react-text --></code></pre><p data-reactid="499"><em data-reactid="500">textarea</em><!-- react-text: 501 --> 的 <!-- /react-text --><code data-reactid="502">onChange</code><!-- react-text: 503 --> 事件 先 reize 再触发 change 事件<!-- /react-text --></p><pre data-reactid="504"><code class="hljs language-javascript" data-query="{}" data-lang="javascript" data-reactid="505"><!-- react-text: 506 -->handleChange(e) {
	<!-- /react-text --><span class="hljs-keyword" data-reactid="507">this</span><!-- react-text: 508 -->.resize();
	<!-- /react-text --><span class="hljs-keyword" data-reactid="509">let</span><!-- react-text: 510 --> value = e.target.value;
	<!-- /react-text --><span class="hljs-keyword" data-reactid="511">this</span><!-- react-text: 512 -->.props.onChange(value);
}<!-- /react-text --></code></pre><p data-reactid="513"><em data-reactid="514">textarea</em><!-- react-text: 515 --> 的 resize 方法<!-- /react-text --></p><pre data-reactid="516"><code class="hljs language-javascript" data-query="{}" data-lang="javascript" data-reactid="517"><!-- react-text: 518 -->resize() {
	<!-- /react-text --><span class="hljs-built_in" data-reactid="519">console</span><!-- react-text: 520 -->.log(<!-- /react-text --><span class="hljs-string" data-reactid="521">&#x27;resizing...&#x27;</span><!-- react-text: 522 -->)
	<!-- /react-text --><span class="hljs-keyword" data-reactid="523">const</span><!-- react-text: 524 --> height = calculateGhostTextareaHeight(<!-- /react-text --><span class="hljs-keyword" data-reactid="525">this</span><!-- react-text: 526 -->.ghostRef, <!-- /react-text --><span class="hljs-keyword" data-reactid="527">this</span><!-- react-text: 528 -->.inputRef);
	<!-- /react-text --><span class="hljs-keyword" data-reactid="529">this</span><!-- react-text: 530 -->.setState({height});
}<!-- /react-text --></code></pre><p data-reactid="531">calculateGhostTextareaHeight 工具方法</p><pre data-reactid="532"><code class="hljs language-javascript" data-query="{}" data-lang="javascript" data-reactid="533"><span class="hljs-comment" data-reactid="534">// 先将内容设置进 ghostTextarea, 再拿到 ghostTextarea.scrollHeight</span><!-- react-text: 535 -->
<!-- /react-text --><span class="hljs-keyword" data-reactid="536">export</span><!-- react-text: 537 --> <!-- /react-text --><span class="hljs-keyword" data-reactid="538">const</span><!-- react-text: 539 --> calculateGhostTextareaHeight = <!-- /react-text --><span class="hljs-function" data-reactid="540"><span class="hljs-keyword" data-reactid="541">function</span><!-- react-text: 542 --> (<!-- /react-text --><span class="hljs-params" data-reactid="543">ghostTextarea, textarea</span><!-- react-text: 544 -->) <!-- /react-text --></span><!-- react-text: 545 -->{
	<!-- /react-text --><span class="hljs-keyword" data-reactid="546">if</span><!-- react-text: 547 --> (!ghostTextarea) {
		<!-- /react-text --><span class="hljs-keyword" data-reactid="548">return</span><!-- react-text: 549 -->;
	}
	ghostTextarea.value = textarea.value || textarea.placeholder || <!-- /react-text --><span class="hljs-string" data-reactid="550">&#x27;x&#x27;</span><!-- react-text: 551 -->
	<!-- /react-text --><span class="hljs-keyword" data-reactid="552">return</span><!-- react-text: 553 --> ghostTextarea.scrollHeight;
}<!-- /react-text --></code></pre><h3 id="优化点-1" data-reactid="554"><a href="#%E4%BC%98%E5%8C%96%E7%82%B9-1" aria-hidden="true" data-reactid="555"><span class="icon icon-link" data-reactid="556"></span></a><!-- react-text: 557 -->优化点<!-- /react-text --></h3><h4 id="避免两次渲染造成内容抖动" data-reactid="558"><a href="#%E9%81%BF%E5%85%8D%E4%B8%A4%E6%AC%A1%E6%B8%B2%E6%9F%93%E9%80%A0%E6%88%90%E5%86%85%E5%AE%B9%E6%8A%96%E5%8A%A8" aria-hidden="true" data-reactid="559"><span class="icon icon-link" data-reactid="560"></span></a><!-- react-text: 561 -->避免两次渲染,造成内容抖动<!-- /react-text --></h4><p data-reactid="562"><!-- react-text: 563 -->在 <!-- /react-text --><code data-reactid="564">react</code><!-- react-text: 565 --> 中, 组件 <!-- /react-text --><code data-reactid="566">receiveProps</code><!-- react-text: 567 --> 的时候会 <!-- /react-text --><code data-reactid="568">render</code><!-- react-text: 569 --> 一次, 给 <!-- /react-text --><code data-reactid="570">textarea</code><!-- react-text: 571 --> 设置 <!-- /react-text --><code data-reactid="572">height</code><!-- react-text: 573 --> 属性也会浏览器的重绘.那么就会造成两次重绘, 并且两次重绘的时候, <!-- /react-text --><code data-reactid="574">textarea</code><!-- react-text: 575 --> 的内容可能会发生抖动.<!-- /react-text --></p><p data-reactid="576">下面两种思路, 在 demo 中均有体现</p><p data-reactid="577"><strong data-reactid="578">优化思路一: 合并祯渲染</strong></p><p data-reactid="579"><!-- react-text: 580 -->使用 <!-- /react-text --><code data-reactid="581">window.requestAnimationFrame</code><!-- react-text: 582 --> &amp; <!-- /react-text --><code data-reactid="583">window.cancelAnimationFrame</code><!-- react-text: 584 --> 来取消第一祯的渲染, 而直接渲染高度已经调整好的 <!-- /react-text --><code data-reactid="585">textarea</code><!-- react-text: 586 -->;<!-- /react-text --></p><p data-reactid="587"><strong data-reactid="588">优化思路二: 减少渲染次数</strong></p><p data-reactid="589"><!-- react-text: 590 -->利用 <!-- /react-text --><code data-reactid="591">react</code><!-- react-text: 592 --> 批处理 <!-- /react-text --><code data-reactid="593">setState</code><!-- react-text: 594 --> 方法, 减少 <!-- /react-text --><code data-reactid="595">rerender</code><!-- react-text: 596 --> 的特性; 在 <!-- /react-text --><code data-reactid="597">textarea onChange</code><!-- react-text: 598 --> 方法中同时触发两个 <!-- /react-text --><code data-reactid="599">setState</code><!-- react-text: 600 -->; <!-- /react-text --><img src="http://upload-images.jianshu.io/upload_images/4217515-05b7453c02c59c1a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="123.png" width="1240" height="339" data-reactid="601"/></p><h3 id="更多优化思路" data-reactid="602"><a href="#%E6%9B%B4%E5%A4%9A%E4%BC%98%E5%8C%96%E6%80%9D%E8%B7%AF" aria-hidden="true" data-reactid="603"><span class="icon icon-link" data-reactid="604"></span></a><!-- react-text: 605 -->更多优化思路<!-- /react-text --></h3><ul data-reactid="606"><li data-reactid="607"><!-- react-text: 608 -->页面存在多个 <!-- /react-text --><code data-reactid="609">textarea</code><!-- react-text: 610 --> 的时候, 能不能考虑 复用同一个 <!-- /react-text --><code data-reactid="611">ghostTextarea</code></li></ul><h2 id="方案三-使用-divcontenteditable-代替-textarea" data-reactid="612"><a href="#%E6%96%B9%E6%A1%88%E4%B8%89-%E4%BD%BF%E7%94%A8-divcontenteditable-%E4%BB%A3%E6%9B%BF-textarea" aria-hidden="true" data-reactid="613"><span class="icon icon-link" data-reactid="614"></span></a><!-- react-text: 615 -->方案三: 使用 div.contenteditable 代替 <!-- /react-text --><em data-reactid="616">textarea</em></h2><h3 id="实现思路-2" data-reactid="617"><a href="#%E5%AE%9E%E7%8E%B0%E6%80%9D%E8%B7%AF-2" aria-hidden="true" data-reactid="618"><span class="icon icon-link" data-reactid="619"></span></a><!-- react-text: 620 -->实现思路<!-- /react-text --></h3><p data-reactid="621"><!-- react-text: 622 -->渲染一个 <!-- /react-text --><code data-reactid="623">div.contenteditable=true</code></p><pre data-reactid="624"><code class="hljs language-javascript" data-query="{}" data-lang="javascript" data-reactid="625"><span class="hljs-keyword" data-reactid="626">return</span><!-- react-text: 627 --> (
    <!-- /react-text --><span class="xml" data-reactid="628"><span class="hljs-tag" data-reactid="629"><!-- react-text: 630 -->&lt;<!-- /react-text --><span class="hljs-name" data-reactid="631">div</span><!-- react-text: 632 --> <!-- /react-text --><span class="hljs-attr" data-reactid="633">className</span><!-- react-text: 634 -->=<!-- /react-text --><span class="hljs-string" data-reactid="635">{style[</span><!-- react-text: 636 -->&#x27;<!-- /react-text --><span class="hljs-attr" data-reactid="637">comp-div-contenteditable</span><!-- react-text: 638 -->&#x27;]}&gt;<!-- /react-text --></span><!-- react-text: 639 -->
        <!-- /react-text --></span><!-- react-text: 640 -->&lt;div
            ref={this.bindRef}
            className={classname(style[&#x27;textarea&#x27;], className, {[style[&#x27;empty&#x27;]]: !value})}
            onChange={this.handleChange}
            onPaste={this.handlePaste}
            placeholder={placeholder}
            contentEditable
        /&gt;
    &lt;/div&gt;<!-- /react-text --><span class="xml" data-reactid="641">
)</span></code></pre><p data-reactid="642"><!-- react-text: 643 -->获取 &amp; 设置 编辑的内容： <!-- /react-text --><code data-reactid="644">textarea</code><!-- react-text: 645 --> 通过 <!-- /react-text --><code data-reactid="646">textarea.value</code><!-- react-text: 647 --> 来取值 or 设置值, 但换成了 <!-- /react-text --><code data-reactid="648">div</code><!-- react-text: 649 --> 之后, 就要使用 <!-- /react-text --><code data-reactid="650">div.innerHTML</code><!-- react-text: 651 --> or <!-- /react-text --><code data-reactid="652">div.innerText</code><!-- react-text: 653 --> 来取值 or 设置值.<!-- /react-text --></p><p data-reactid="654"><!-- react-text: 655 -->使用 <!-- /react-text --><code data-reactid="656">div.innerHTML</code><!-- react-text: 657 --> 会出现以下两种问题:<!-- /react-text --></p><ul data-reactid="658"><li data-reactid="659"><code data-reactid="660">&amp;</code><!-- react-text: 661 --> 会被转码成 <!-- /react-text --><code data-reactid="662">&amp;amp;</code></li><li data-reactid="663"><!-- react-text: 664 -->空白符合并 使用 <!-- /react-text --><code data-reactid="665">div.innerText</code><!-- react-text: 666 --> 在低版本 firfox 上要做兼容处理.<!-- /react-text --></li></ul><p data-reactid="667"><!-- react-text: 668 -->因此使用哪种方式 <!-- /react-text --><strong data-reactid="669">主要看需求</strong><!-- react-text: 670 -->.<!-- /react-text --></p><p data-reactid="671">placeholder 的实现:</p><p data-reactid="672"><code data-reactid="673">div</code><!-- react-text: 674 --> 的 <!-- /react-text --><code data-reactid="675">placeholder</code><!-- react-text: 676 --> 属性是无效, 不会显示出来的, 现存一种最简单的方式, 使用纯 <!-- /react-text --><code data-reactid="677">css</code><!-- react-text: 678 --> 的方式实现 <!-- /react-text --><code data-reactid="679">div</code><!-- react-text: 680 --> 的 <!-- /react-text --><code data-reactid="681">placeholder</code></p><pre data-reactid="682"><code class="hljs language-css" data-query="{}" data-lang="css" data-reactid="683"><span class="hljs-selector-class" data-reactid="684">.textarea</span><span class="hljs-selector-attr" data-reactid="685">[placeholder]</span><span class="hljs-selector-pseudo" data-reactid="686">:empty</span><span class="hljs-selector-pseudo" data-reactid="687">:before</span><!-- react-text: 688 --> { <!-- /react-text --><span class="hljs-comment" data-reactid="689">/*empty &amp; before 两个伪类*/</span><!-- react-text: 690 -->
	<!-- /react-text --><span class="hljs-attribute" data-reactid="691">content</span><!-- react-text: 692 -->: <!-- /react-text --><span class="hljs-built_in" data-reactid="693">attr</span><!-- react-text: 694 -->(placeholder); <!-- /react-text --><span class="hljs-comment" data-reactid="695">/*attr 函数*/</span><!-- react-text: 696 -->
	<!-- /react-text --><span class="hljs-attribute" data-reactid="697">color</span><!-- react-text: 698 -->: <!-- /react-text --><span class="hljs-number" data-reactid="699">#555</span><!-- react-text: 700 -->;
}<!-- /react-text --></code></pre><h3 id="优化点-2" data-reactid="701"><a href="#%E4%BC%98%E5%8C%96%E7%82%B9-2" aria-hidden="true" data-reactid="702"><span class="icon icon-link" data-reactid="703"></span></a><!-- react-text: 704 -->优化点<!-- /react-text --></h3><h4 id="去除支持富文本" data-reactid="705"><a href="#%E5%8E%BB%E9%99%A4%E6%94%AF%E6%8C%81%E5%AF%8C%E6%96%87%E6%9C%AC" aria-hidden="true" data-reactid="706"><span class="icon icon-link" data-reactid="707"></span></a><!-- react-text: 708 -->去除支持富文本<!-- /react-text --></h4><p data-reactid="709"><code data-reactid="710">div.contenteditable</code><!-- react-text: 711 --> 是默认支持富文本的, 可能会以 <!-- /react-text --><strong data-reactid="712">粘贴</strong><!-- react-text: 713 --> or <!-- /react-text --><strong data-reactid="714">拖拽</strong><!-- react-text: 715 --> 让输入框出现富文本;<!-- /react-text --></p><img src="http://upload-images.jianshu.io/upload_images/4217515-942edb0bb73b3810.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="234.png" width="786" height="325" data-reactid="716"/><p data-reactid="717">监听 div 的 onPaste 事件</p><pre data-reactid="718"><code data-query="{}" data-lang="data-lang" data-reactid="719">handlePaste(e) {
    e.preventDefault();
    let text = e.clipboardData.getData(&#x27;text/plain&#x27;); // 拿到纯文本
    document.execCommand(&#x27;insertText&#x27;, false, text); // 让浏览器执行插入文本操作
}
</code></pre><p data-reactid="720"><a href="http://www.zhangxinxu.com/wordpress/2016/01/contenteditable-plaintext-only/" data-reactid="721"><strong data-reactid="722">handlePaste 的更多兼容性处理</strong></a></p><h2 id="几个大网站的高度自适应-textarea-对比" data-reactid="723"><a href="#%E5%87%A0%E4%B8%AA%E5%A4%A7%E7%BD%91%E7%AB%99%E7%9A%84%E9%AB%98%E5%BA%A6%E8%87%AA%E9%80%82%E5%BA%94-textarea-%E5%AF%B9%E6%AF%94" aria-hidden="true" data-reactid="724"><span class="icon icon-link" data-reactid="725"></span></a><!-- react-text: 726 -->几个大网站的高度自适应 <!-- /react-text --><em data-reactid="727">textarea</em><!-- react-text: 728 --> 对比<!-- /react-text --></h2><p data-reactid="729"><!-- react-text: 730 -->我分别查看了<!-- /react-text --><a href="/weibo.com" data-reactid="731">微博</a><!-- react-text: 732 -->, <!-- /react-text --><a href="/ant.design" data-reactid="733">ant.design组件库</a><!-- react-text: 734 -->, <!-- /react-text --><a href="/www.zhihu.com" data-reactid="735">知乎</a><!-- react-text: 736 --> 的自适应输入框的实现.<!-- /react-text --></p><h3 id="微博-采用方案二" data-reactid="737"><a href="#%E5%BE%AE%E5%8D%9A-%E9%87%87%E7%94%A8%E6%96%B9%E6%A1%88%E4%BA%8C" aria-hidden="true" data-reactid="738"><span class="icon icon-link" data-reactid="739"></span></a><!-- react-text: 740 -->微博: 采用方案二<!-- /react-text --></h3><p data-reactid="741">未输入时</p><img src="http://upload-images.jianshu.io/upload_images/4217515-ec0ae559ecac069f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="5aa4b41fdf0082f1c9.png" width="648" height="247" data-reactid="742"/><p data-reactid="743">输入后</p><img src="http://upload-images.jianshu.io/upload_images/4217515-6fd8b07173997039.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="5aa4b4517a668254df.png" width="639" height="344" data-reactid="744"/><p data-reactid="745"><!-- react-text: 746 -->但是微博的实现存在<!-- /react-text --><strong data-reactid="747">用户体验</strong><!-- react-text: 748 -->上的缺陷, <!-- /react-text --><strong data-reactid="749">会抖动!!!</strong></p><img src="http://upload-images.jianshu.io/upload_images/4217515-2bb4d2992db9c18f.gif?imageMogr2/auto-orient/strip" alt="weibo.git.gif" width="360" height="240" data-reactid="750"/><h3 id="antdesign-采用方案二" data-reactid="751"><a href="#antdesign-%E9%87%87%E7%94%A8%E6%96%B9%E6%A1%88%E4%BA%8C" aria-hidden="true" data-reactid="752"><span class="icon icon-link" data-reactid="753"></span></a><!-- react-text: 754 -->ant.design: 采用方案二<!-- /react-text --></h3><p data-reactid="755">体验超级棒哦</p><img src="http://upload-images.jianshu.io/upload_images/4217515-614691d5b58f4e18.gif?imageMogr2/auto-orient/strip" alt="antd.gif" width="360" height="240" data-reactid="756"/><h3 id="知乎-采用方案三" data-reactid="757"><a href="#%E7%9F%A5%E4%B9%8E-%E9%87%87%E7%94%A8%E6%96%B9%E6%A1%88%E4%B8%89" aria-hidden="true" data-reactid="758"><span class="icon icon-link" data-reactid="759"></span></a><!-- react-text: 760 -->知乎: 采用方案三<!-- /react-text --></h3><p data-reactid="761">看上去竟然存在 bug , 其实上面的截图也有</p><img src="http://upload-images.jianshu.io/upload_images/4217515-3210eab87c15f92f.gif?imageMogr2/auto-orient/strip" alt="zhih.gif" width="360" height="240" data-reactid="762"/><h2 id="参考链接列表" data-reactid="763"><a href="#%E5%8F%82%E8%80%83%E9%93%BE%E6%8E%A5%E5%88%97%E8%A1%A8" aria-hidden="true" data-reactid="764"><span class="icon icon-link" data-reactid="765"></span></a><!-- react-text: 766 -->参考链接列表<!-- /react-text --></h2><ul data-reactid="767"><li data-reactid="768"><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTML/Element/textarea" data-reactid="769">textarea mdn 文档</a><!-- react-text: 770 -->: 看看有哪些影响 textarea 宽高的属性<!-- /react-text --></li><li data-reactid="771"><a href="http://www.zhangxinxu.com/wordpress/2016/02/html-textarea-rows-height/" data-reactid="772">HTML textarea cols,rows属性和宽度高度关系研究</a></li><li data-reactid="773"><a href="https://css-tricks.com/textarea-tricks/" data-reactid="774">CSS Tricks</a><!-- react-text: 775 -->: textarea 使用上的小技巧. 一些样式技巧.<!-- /react-text --></li><li data-reactid="776"><a href="https://andreypopp.github.io/react-textarea-autosize/" data-reactid="777">开源的 react auto resize textarea</a><!-- react-text: 778 -->: 一个更好的方案二的实现, 源码优雅短小<!-- /react-text --></li><li data-reactid="779"><a href="/www.caniuse.com" data-reactid="780">can i use 兼容性检查工具</a><!-- react-text: 781 -->: execCommand, innerText, requireAnimationFrame, 等等各种各样属性的兼容性检查<!-- /react-text --></li><li data-reactid="782"><a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Global_attributes/contenteditable" data-reactid="783">contenteditable MDN</a></li><li data-reactid="784"><a href="https://gist.github.com/Schniz/e398a630c81cfd8a3d1e" data-reactid="785">一个方案三的实现, a good demo</a></li><li data-reactid="786"><a href="http://www.zhangxinxu.com/wordpress/2016/01/contenteditable-plaintext-only/" data-reactid="787">小tip: 如何让contenteditable元素只能输入纯文本</a></li></ul></article><div data-reactid="788"></div><nav class="single-bar clearfix" data-reactid="789"><span class="prev" data-reactid="790"><a rel="prev" href="/blog/fe/控制图标颜色" data-reactid="791"><em class="eux-icon eux-icon-page-prev" data-reactid="792"></em><!-- react-text: 793 -->CSS 控制图标颜色<!-- /react-text --></a></span><span class="next" data-reactid="794"><a rel="next" href="/blog/fe/深入理解window.onload" data-reactid="795"><em class="eux-icon eux-icon-page-next" data-reactid="796"></em><!-- react-text: 797 -->深入理解 window.onload<!-- /react-text --></a></span></nav></div></div></div><footer class="footer" data-reactid="798"><div class="eux-footer-area-wrapper container-singular" role="complementary" data-reactid="799"><div class="inner clearfix" data-reactid="800"><aside id="simple-links-2" class="widget sl-links-main" data-reactid="801"><h2 class="widgettitle" data-reactid="802">友情链接</h2><ul class="simple-links-list simple-links-2-list" id="simple-links-2-list" data-reactid="803"><li class="simple-links-item simple-links-widget-item" id="link-379" data-reactid="804"><a target="_blank" href="http://sux.baidu.com/" title="百度 FEX 团队" data-reactid="805">百度 FEX</a></li><li class="simple-links-item simple-links-widget-item" id="link-379" data-reactid="806"><a target="_blank" href="http://efe.baidu.com/" title="百度 EFE 团队" data-reactid="807">百度 EFE</a></li><li class="simple-links-item simple-links-widget-item" id="link-379" data-reactid="808"><a target="_blank" href="http://sux.baidu.com/" title="百度 SUX 团队" data-reactid="809">百度 SUX</a></li><li class="simple-links-item simple-links-widget-item" id="link-379" data-reactid="810"><a target="_blank" href="https://aotu.io/" title="京东凹凸实验室，面向多终端技术体系，致力于构建沉淀与分享包括但不限于交互、页面制作技巧、前端开发、原生APP开发等方面的专业知识及案例。" data-reactid="811">凹凸实验室</a></li><li class="simple-links-item simple-links-widget-item" id="link-379" data-reactid="812"><a target="_blank" href="https://fed.renren.com/" title="人人网FED" data-reactid="813">人人网FED</a></li></ul></aside></div></div><div class="eux-icp" data-reactid="814"><!-- react-text: 815 -->百度EUX 版权所有 ©百度EUX    All rights reserved. 骄傲地采用 <!-- /react-text --><a target="_blank" href="https://github.com/picidaejs/picidaejs" data-reactid="816">Picidae</a><!-- react-text: 817 -->。<!-- /react-text --></div></footer></div>
</div>
<script src="/PICIDAE_COMMON.js"></script>
<script src="/PICIDAE_ENTRY.js"></script>
</body>
</html>